<script>
  import Button from "../Button.html";
  import fetchOptions from "../../helpers/fetchOptions.js";

  export let closeForm;
  export let drawPlace;

  import { places, modalItem } from "../../stores.js";

  let placeInput = { state: "NY" };

  async function submitForm() {
    const url = "/api/places/new";
    const options = Object.assign(
      { body: JSON.stringify(placeInput) },
      fetchOptions.post
    );
    var response = await fetch(url, options);
    const responseJson = await response.json();
    addPlace(responseJson);
    modalItem.update(n => null); // Close form
    return responseJson;
  }
  
  function addPlace(place) {
    places.update(n => {
      n.push(place);
      return n;
    });
    drawPlace(place);
  }
  
  
</script>

<div id="new-place-form" class="form">
  <h1>
    New Place
  </h1>
  <form>
    <label>Name:</label>
    <input bind:value="{placeInput.name}" type="text" autocomplete="off" />
    <label>Address:</label>
    <input bind:value="{placeInput.address}" type="text" autocomplete="off" />
    <label>City:</label>
    <input bind:value="{placeInput.city}" type="text" autocomplete="off" />
    <label>State:</label>
    <input bind:value="{placeInput.state}" type="text" autocomplete="off" />
    <label>Zip:</label>
    <input bind:value="{placeInput.zip}" type="text" autocomplete="off" />
    <label>Year Opened:</label>
    <input
      bind:value="{placeInput.openYear}"
      min="1800"
      max="2020"
      type="number"
      autocomplete="off"
    />
    <label>Date Closed:</label>
    <input bind:value="{placeInput.closeDate}" type="date" autocomplete="off" />
    <Button label={'Cancel'} type={'cancel'} onClick={closeForm} />
    <Button label={'Save'} type={'create'} onClick={submitForm} />
  </form>
</div>

<style></style>
